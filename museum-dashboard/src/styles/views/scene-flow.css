/* src/styles/views/scene-flow.css */

/* --- HLAVNÝ KONTAJNER --- */
.flow-wrapper { 
    width: 100%; 
    height: 100%; 
    background-color: var(--bg-main); 
    display: flex; 
    flex-direction: column; 
    position: relative;
    overflow: hidden;
}

/* --- HORNÁ LIŠTA (TABS) --- */
.editor-tabs { 
    display: flex; 
    gap: 8px; 
    padding: 12px 24px; 
    background: var(--bg-card); 
    border-bottom: 1px solid var(--border-color); 
    flex-shrink: 0;
    z-index: 10;
}

.editor-tab-btn { 
    padding: 8px 16px; 
    border-radius: var(--radius-md); 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    gap: 8px; 
    font-weight: 500; 
    font-size: 0.9rem;
    color: var(--text-secondary); 
    background: transparent; 
    border: 1px solid transparent;
    transition: all 0.2s ease;
}

.editor-tab-btn:hover { 
    background: var(--bg-hover); 
    color: var(--text-primary); 
}

.editor-tab-btn.active { 
    background: var(--primary); 
    color: var(--text-white); 
    box-shadow: var(--shadow-sm);
}

/* --- NODE KARTA (ZÁKLAD) --- */
.custom-flow-node {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    width: 380px; /* Šírka prispôsobená pre dlhšie texty */
    box-shadow: var(--shadow-md);
    transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    flex-direction: column;
}

/* Hover efekt pre kartu */
.custom-flow-node:hover {
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
    transform: translateY(-2px);
    z-index: 100 !important; /* Vždy navrchu pri hoveri */
}

/* Varianty pre Start a End */
.custom-flow-node.start-node { 
    border-top: 4px solid var(--success); 
}

.custom-flow-node.end-node { 
    border-top: 4px solid var(--danger); 
    background: #fffafa; /* Jemný nádych červenej/bielej */
}

/* --- HEADER NODE-U --- */
.node-header {
    padding: 12px 16px;
    background: linear-gradient(to bottom, var(--bg-card), var(--bg-hover));
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    transition: background 0.2s;
}

.custom-flow-node:not(.expanded) .node-header {
    border-bottom: 1px solid transparent; /* Aby pri zbalení nebola dvojitá čiara */
    border-radius: var(--radius-lg);
}

.node-header:hover {
    background: var(--bg-hover);
}

.node-title-group {
    display: flex;
    align-items: center;
    gap: 12px;
}

.node-icon-box {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: var(--bg-main);
    color: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
    flex-shrink: 0;
}

.start-node .node-icon-box { background: var(--success-bg); color: var(--success); border-color: transparent; }
.end-node .node-icon-box { background: var(--danger-bg); color: var(--danger); border-color: transparent; }

.node-label {
    font-weight: 700;
    font-size: 0.95rem;
    color: var(--text-primary);
}

.expand-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    cursor: pointer;
}

.expand-btn:hover {
    background: var(--bg-active);
    color: var(--text-primary);
}

/* --- ZBALENÝ STAV (PREVIEW DESCRIPTION) --- */
.node-preview-bar.description-only {
    padding: 10px 16px 14px 16px;
    background: var(--bg-card);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    /* border-top: 1px solid var(--border-color); */
    min-height: 40px;
}

.preview-desc-row {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    width: 100%;
}

.desc-text {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
    font-style: italic;
    
    /* Oreže text po 3 riadkoch a pridá '...' */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* --- ROZBALENÝ STAV (CONTENT) --- */
.node-content {
    background: var(--bg-card);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
}

.node-description {
    padding: 12px 16px;
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
    background: var(--bg-main);
    border-bottom: 1px dashed var(--border-color);
    font-style: italic;
}

/* Sekcie (On Enter / Timeline) */
.node-section {
    padding: 0;
}

.section-label {
    padding: 8px 16px;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    font-weight: 700;
    background: var(--bg-hover);
    border-top: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Riadky s akciami */
.action-row {
    display: flex;
    align-items: flex-start; /* Zarovnanie hore kvoli viacriadkovemu textu */
    gap: 12px;
    padding: 10px 16px;
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-card);
    transition: background 0.1s;
}

.action-row:last-child {
    border-bottom: none;
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
}

.action-row:hover {
    background: var(--bg-hover);
}

.action-icon {
    color: var(--text-secondary);
    margin-top: 3px; /* Opticke zarovnanie s prvým riadkom textu */
    flex-shrink: 0;
    opacity: 0.8;
}

.action-text {
    font-family: 'Consolas', 'Monaco', monospace; /* Monospace pre technické dáta */
    font-size: 0.85rem;
    color: var(--text-primary);
    line-height: 1.5;
    
    /* Povoliť zalamovanie dlhých textov */
    white-space: pre-wrap;
    word-break: break-word;
}

/* Timeline špecifiká */
.action-row.timeline {
    background: #fffbeb; /* Veľmi svetlá žltá/amber */
}
/* Tmavý režim fallback (ak máte dark mode, toto by malo byť cez premenné) */
@media (prefers-color-scheme: dark) {
    .action-row.timeline { background: rgba(245, 158, 11, 0.1); }
}

.action-row.timeline .action-text {
    color: #b45309; /* Tmavá amber farba */
}

/* --- HANDLES (Guličky na pripojenie) --- */
.react-flow__handle {
    width: 10px;
    height: 10px;
    border: 2px solid var(--bg-card);
    background: var(--text-secondary);
    box-shadow: 0 0 0 1px var(--border-color);
    transition: all 0.2s ease;
}

.react-flow__handle:hover {
    width: 14px;
    height: 14px;
    background: var(--primary);
    box-shadow: 0 0 0 2px var(--primary-bg);
}

.node-handle.target { 
    top: -6px; 
    border-radius: 0 0 4px 4px; 
}

.node-handle.source { 
    bottom: -6px; 
    border-radius: 4px 4px 0 0; 
    background: var(--primary); 
}

/* --- LEGENDA (Panel vľavo dole) --- */
.panel-legend {
    background: var(--bg-card);
    padding: 12px 16px;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-lg);
    color: var(--text-primary);
    min-width: 200px;
}

.node-handles-container {
    position: absolute;
    bottom: -6px; /* Aby "pretŕčali" polovicou von */
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-evenly; /* Rozložíme ich rovnomerne po šírke */
    padding: 0 20px; /* Odsadenie od krajov */
    pointer-events: none; /* Aby neblokovali klikanie na kartu */
}

/* Prepíšeme default štýl pre dynamické handles */
.custom-flow-node .react-flow__handle.dynamic-source {
    position: static; /* Flexbox ich umiestni, nie absolute positioning */
    transform: none;
    pointer-events: all; /* Samotný gulička musí byť klikateľná */
    background: var(--primary);
    width: 10px;
    height: 10px;
    border-radius: 50%;
    border: 2px solid var(--bg-card);
}

.custom-flow-node .react-flow__handle.dynamic-source:hover {
    width: 14px;
    height: 14px;
    background: var(--primary-hover);
}